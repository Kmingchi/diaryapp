<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title> 비망록 </title>
<link rel="stylesheet" href="css/diary/private.css">
<link rel="stylesheet" href="css/navbar.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js" integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/749925e73b.js" crossorigin="anonymous"></script>
</head>
<body>
<iframe src="/fragment/nav"></iframe>

<main>
	<section>
		<div>
			<div class="title" colspan="5">
				<p class="prev" onClick="prevCalendar();" style="cursor:pointer;">
					<i class="fas fa-caret-left"></i>
				</p>
				<div class="ym-box">
					<span id="cal-year"></span>
					<span id="cal-month"></span>
				</div>
				<p class="next" onClick="nextCalendar();" style="cursor:pointer;">
					<i class="fas fa-caret-right"></i>
				</p>
			</div>
		</div>
		<table class="calendar">
			<thead>
				<tr>
					<td style="color: tomato;">SUN</td>
					<td >MON</td>
					<td >TUE</td>
					<td >WED</td>
					<td >THU</td>
					<td>FRI</td>
					<td style="color: royalblue;">SAT</td>
				</tr>
			</thead>
			<tbody class="tbody"></tbody>
		</table>
	</section>
	
	<!-- 기분 스티커 선택 -->
	<div id="modalWrap">
	    <div id="modalBody">
	          <div class="imoticon" id="smile">
	            <img src="/image/emoji/smile.png" alt="smile">
	          </div>
	          <div class="imoticon" id="sad">
	            <img src="../../../../../image/emoji/sad.png" alt="sad">
	          </div>
	          <div class="imoticon" id="excited">
	            <img src="../../../../../image/emoji/excited.png" alt="excited">
	          </div>
	          <div class="imoticon" id="angry">
	            <img src="../../../../../image/emoji/angry.png" alt="angry">
	          </div>
	          <div class="imoticon" id="relax">
	            <img src="../../../../../image/emoji/relax.png" alt="relax">
	          </div>
	          <div class="imoticon" id="surprised">
	            <img src="../../../../../image/emoji/surprised.png" alt="surprised">
	          </div>
	          <div class="line-box" id="line-box">
	            <i class="far fa-times-circle" style="color:#212121;"></i>
	          </div>
	    </div>
	</div>

	<!-- 다이어리 작성 -->
	<div id="modalWrap-2">
	  <div id="modalBody-2">
	    <!-- 기분 스티커 -->
	    <div id="img-box"></div>
	    <!-- 날짜 -->
	    <div class="modal-date" id="modal-date" style="width: 160px; height: 100px;"></div>
	    <i id="closeBtn" class="fas fa-times"  style="color: #212121; font-size:30px;"></i>
	    <!-- 내용 -->
	    <div class="todo">
			<input type="text" id="todo-input" placeholder="할 일을 입력하세요" maxlength="10">
	    </div>
	    <div class="diary-box">
			<ul id="todo-list"></ul>
	    </div>
	    <div class="btngroup">
			<button id="add" onclick="addTodo()"> 입력 </button>
			<button id="save" onclick="saveTodo()"> 저장 </button>
		</div>
		<button class="btn-input" onclick="goToDiary()"> 다이어리 작성 </button>
	  </div>
	</div>
	
	<!-- 투두리스트 상세보기 모달 -->
	<div id="detailModalWrap">
		<div id="detailModalBody">
			<!-- 기분 스티커 -->
		    <div id="detail-img-box" style="width: 100px; height: 100px;"></div>
		    <!-- 날짜 -->
		    <div class="modal-date" id="detail-modal-date" style="width: 120px; height: 100px;"></div>
		    <i id="closeDetailBtn" class="fas fa-times"  style="color: #212121; font-size:30px;"></i>
		    <!-- 내용 -->
			<div class="todo-add">
				<input type="text" id="todo-add" placeholder="할 일을 입력하세요" maxlength="10">
	    	</div>
	    	<div class="newbtngroup">
				<button id="newtodo" onclick="todoAdd()"> 추가 </button>
				<button id="clear" onclick="clearTodo()"> 완료 </button>
			</div>
		    <div class="diary-box2">
				<p id="detail-content"></p>
				<ul id="newtodo-list"></ul>
			</div>
		</div>
	</div>
</main>

<!-- 팝업과 배경 오버레이 -->
<div id="overlay"></div>
<div id="datepicker-container">
	<div class="select-wheel">
        <select id="year"></select>
        <select id="month"></select>
		<button type="button" id="closePopup">cancel</button>
    </div>
</div>

<script src="/javascript/diary/private.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script>
$(document).ready(function() {
    // ym-box 클릭 시 팝업과 오버레이 표시
    $('.ym-box').click(function() {
        $('#overlay').fadeIn();
        $('#datepicker-container').fadeIn();
    });

    // 팝업 닫기 버튼 클릭 시 팝업과 오버레이 숨기기
    $('#closePopup').click(function() {
        $('#overlay').fadeOut();
        $('#datepicker-container').fadeOut();
    });

    // 현재 연도와 월을 datepicker-container에 설정
    var currentYear = new Date().getFullYear();
    var currentMonth = new Date().getMonth() + 1;
    var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

    for (var i = currentYear - 50; i <= currentYear + 50; i++) {
        $('#year').append($('<option>', {
            value: i,
            text: i
        }));
    }

    for (var j = 0; j < months.length; j++) {
        $('#month').append($('<option>', {
            value: j+1,
            text: months[j]
        }));
    }

    $('#year').val(currentYear);
    $('#month').val(currentMonth);

    let yearSelected = false;
    let monthSelected = false;

    function checkSelection() {
        if (yearSelected && monthSelected) {
            $('#overlay').fadeOut();
            $('#datepicker-container').fadeOut();

            // 선택한 연도와 월로 달력 업데이트
            var selectedYear = $('#year').val();
            var selectedMonth = $('#month').val();
            $('#cal-year').text(selectedYear);
            $('#cal-month').text(months[selectedMonth - 1]);
            nowMonth = new Date(selectedYear, selectedMonth - 1);
            buildCalendar();
        }
    }
    
    // datepicker-container에서 선택한 연도와 월을 설정
    $('#year').change(function() {
        yearSelected = true;
        checkSelection();
    });

    $('#month').change(function() {
        monthSelected = true;
        checkSelection();
    });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const iframe = document.querySelector("iframe");
  iframe.onload = function() {
    const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;
    const dropdownItems = iframeDocument.querySelectorAll(".dropdown-item");
    dropdownItems.forEach(function(item) {
      item.addEventListener("click", function() {
        window.location.href = item.getAttribute("data-url");
      });
    });
  };
});
</script>
</body>
</html>